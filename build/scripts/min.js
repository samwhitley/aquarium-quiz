!function(){function a(a){a instanceof Array?a.forEach(function(a){b(a)}):b(a)}function b(a){if(f[a])return f[a];var b=new Image;b.onload=function(){f[a]=b,d()&&g.forEach(function(a){a()})},f[a]=!1,b.src=a}function c(a){return f[a]}function d(){var a=!0;for(var b in f)f.hasOwnProperty(b)&&!f[b]&&(a=!1);return a}function e(a){g.push(a)}var f={},g=[];window.resources={load:a,get:c,onReady:e,isReady:d}}(),function(){function a(a,b,c,d,e,f,g){this.pos=b,this.size=c,this.speed="number"==typeof d?d:0,this.frames=e,this._index=0,this.url=a,this.dir=f||"horizontal",this.once=g}a.prototype={update:function(a){this._index+=this.speed*a},render:function(a){var b;if(this.speed>0){var c=this.frames.length,d=Math.floor(this._index);if(b=this.frames[d%c],this.once&&d>=c)return void(this.done=!0)}else b=0;var e=this.pos[0],f=this.pos[1];"vertical"==this.dir?f+=b*this.size[1]:e+=b*this.size[0],a.drawImage(resources.get(this.url),e,f,this.size[0],this.size[1],0,0,this.size[0],this.size[1])}},window.Sprite=a}();var AQUARIUM={};AQUARIUM.main=function(){function a(){console.log("main: init()"),AQUARIUM.width=500,AQUARIUM.height=500,AQUARIUM.canvas=document.createElement("canvas"),AQUARIUM.ctx=AQUARIUM.canvas.getContext("2d"),AQUARIUM.canvas.width=AQUARIUM.width,AQUARIUM.canvas.height=AQUARIUM.height,document.body.appendChild(AQUARIUM.canvas),AQUARIUM.input.connectEvents(),resources.load(["images/sprites-left.png","images/sprites-right.png","images/fyush.png"]),resources.onReady(function(){c("title"),b()})}function b(){function a(){var c=Date.now(),f=(c-b)/1e3;e(a),AQUARIUM.ctx.clearRect(0,0,AQUARIUM.width,AQUARIUM.height),d.update(f),d.render(),b=c}var b=Date.now();a()}function c(a){if(!f){switch(f=!0,a){case"title":AQUARIUM.titleScreen.init(),d=AQUARIUM.titleScreen;break;case"menu":AQUARIUM.menuScreen.init(),d=AQUARIUM.menuScreen;break;case"fish":AQUARIUM.fishScreen.init(),d=AQUARIUM.fishScreen;break;case"question":AQUARIUM.questionScreen.init(),d=AQUARIUM.questionScreen;break;case"result":d=AQUARIUM.resultScreen}f=!1}}var d,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},f=!1;return{init:a,changeScreen:c}}(),AQUARIUM.input=function(){function a(){console.log("main: connectEvents");var a=function(a){var b=!1,c=0,d=0;return a.addEventListener("mousedown",function(e){b=!0,c=e.clientX-a.offsetLeft,d=e.clientY-a.offsetTop}),a.addEventListener("mouseup",function(e){b=!1,c=e.clientX-a.offsetLeft,d=e.clientY-a.offsetTop}),{isButtonDown:function(){return b},x:function(){return c},y:function(){return d}}}(AQUARIUM.canvas);window.mouse=a}function b(){g=mouse.isButtonDown(),c=!g&&h,h=g}function c(){return c}function d(a,b){a.width=b.measureText(a.text).width,a.height=parseInt(b.font)}function e(a){a.x=(AQUARIUM.width-a.width)/2}function f(a){var b=!1,c=mouse.x(),d=mouse.y();return c>=a.x&&c<=a.x+a.width&&d>=a.y-a.height&&d<=a.y&&a.action(),b}var g,h,c;return{connectEvents:a,setInputState:b,justClicked:c,setTextDimensions:d,centerText:e,isTextClicked:f}}(),AQUARIUM.utils=function(){function a(a){return Math.floor(Math.random()*a.length)}return{randomIndex:a}}(),AQUARIUM.fishScreen=function(){function a(){console.log("fishScreen: init"),h=setInterval(d,1e3),l={fish:0,red:0,green:0,gold:0,small:{total:0,red:0,green:0,gold:0},medium:{total:0,red:0,green:0,gold:0},large:{total:0,red:0,green:0,gold:0}},g()}function b(a){for(var b,c,d,e,f,g,h=0,j=i.length;j>h;h++)b=i[h].pos[0],c=i[h].pos[1],d=i[h].dx,e=i[h].dy,f=i[h].size[0],g=i[h].size[1],(b+f+d*a>AQUARIUM.width||0>b+d*a)&&(i[h].dx=-d,i[h].sprite=i[h].dx>0?i[h].rightSprite:i[h].leftSprite),(c+g+e*a>AQUARIUM.height||0>c+e*a)&&(i[h].dy=-e),i[h].pos[0]+=i[h].dx*a,i[h].pos[1]+=i[h].dy*a}function c(){var a;AQUARIUM.ctx.fillStyle="#000000",AQUARIUM.ctx.fillRect(0,0,AQUARIUM.width,AQUARIUM.height);for(var b=0,c=i.length;c>b;b++)a=i[b],AQUARIUM.ctx.save(),AQUARIUM.ctx.translate(a.pos[0],a.pos[1]),a.sprite.render(AQUARIUM.ctx),AQUARIUM.ctx.restore();AQUARIUM.ctx.fillStyle="#FFFFFF",AQUARIUM.ctx.font="24pt sans-serif",AQUARIUM.ctx.fillText(n,50,50)}function d(){n-=1,0===n&&(clearInterval(h),AQUARIUM.main.changeScreen("question"))}function e(){var a=AQUARIUM.utils.randomIndex(k),b=k[a],c=AQUARIUM.utils.randomIndex(b.colors),d=b.colors[c],e={},f=Math.floor(Math.random()*AQUARIUM.width+1),g=Math.floor(Math.random()*AQUARIUM.height+1);return l.fish+=1,l[d.name]+=1,l[b.type].total+=1,l[b.type][d.name]+=1,f+b.size[0]>AQUARIUM.width&&(f-=b.size[0]),g+b.size[1]>AQUARIUM.height&&(g-=b.size[1]),e.pos=[f,g],e.type=b.type,e.size=b.size,e.color=d.name,e.leftSprite=new Sprite("images/sprites-left.png",d.pos,b.size),e.rightSprite=new Sprite("images/sprites-right.png",d.pos,b.size),e.dx=b.speed,e.sprite=e.rightSprite,Math.random()<.5?(e.dx=b.speed+Math.floor(20*Math.random()),e.sprite=e.rightSprite):(e.dx=-b.speed-Math.floor(20*Math.random()),e.sprite=e.leftSprite),e.dy=Math.random()<.5?Math.floor(b.speed/2)+30*Math.random():Math.floor(-b.speed/2)-30*Math.random(),e}function f(){return l}function g(){console.log("fishScreen: reset"),n=m,i=[];for(var a=0;j>a;a++)i.push(e())}var h,i=[],j=30+(Math.floor(30*Math.random())+1),k=[{type:"small",size:[57,26],speed:100,colors:[{name:"green",pos:[90,0]},{name:"red",pos:[90,27]},{name:"gold",pos:[90,55]}]},{type:"medium",size:[88,44],speed:75,colors:[{name:"green",pos:[0,0]},{name:"red",pos:[0,45]},{name:"gold",pos:[0,90]}]},{type:"large",size:[97,101],speed:50,colors:[{name:"green",pos:[150,0]},{name:"red",pos:[150,102]},{name:"gold",pos:[150,204]}]}],l={},m=5,n=0;return{init:a,update:b,render:c,reset:g,getTotals:f}}(),AQUARIUM.titleScreen=function(){function a(){e=new Image,e.src="images/fyush.png",f=setInterval(c,500)}function b(){AQUARIUM.input.setInputState(),AQUARIUM.input.justClicked()&&AQUARIUM.main.changeScreen("menu")}function c(){g=!g}function d(){AQUARIUM.ctx.save(),AQUARIUM.ctx.fillStyle="#001758",AQUARIUM.ctx.fillRect(0,0,AQUARIUM.width,AQUARIUM.height),AQUARIUM.ctx.fillStyle="#FFFFFF",AQUARIUM.ctx.textAlign="center",AQUARIUM.ctx.drawImage(e,50,75),AQUARIUM.ctx.font="3em sans-serif",AQUARIUM.ctx.fillText("Aquarium Quiz",AQUARIUM.width/2,285),g&&(AQUARIUM.ctx.font="1.5em sans-serif",AQUARIUM.ctx.fillText("Click to play",AQUARIUM.width/2,335)),AQUARIUM.ctx.restore()}var e,f,g=!0;return{init:a,update:b,render:d}}(),AQUARIUM.menuScreen=function(){function a(){d.y=AQUARIUM.height/2-30,e.y=AQUARIUM.height/2+30}function b(){AQUARIUM.input.setInputState(),AQUARIUM.input.justClicked()&&(AQUARIUM.input.isTextClicked(d),AQUARIUM.input.isTextClicked(e))}function c(){AQUARIUM.ctx.save(),AQUARIUM.ctx.fillStyle="#27662A",AQUARIUM.ctx.fillRect(0,0,AQUARIUM.width,AQUARIUM.height),AQUARIUM.ctx.fillStyle="#FFFFFF",AQUARIUM.ctx.font="24pt sans-serif",AQUARIUM.input.setTextDimensions(d,AQUARIUM.ctx),AQUARIUM.input.centerText(d),AQUARIUM.ctx.fillText(d.text,d.x,d.y),AQUARIUM.input.setTextDimensions(e,AQUARIUM.ctx),AQUARIUM.input.centerText(e),AQUARIUM.ctx.fillText(e.text,e.x,e.y),AQUARIUM.ctx.restore()}var d={text:"Start one player game",x:0,y:0,width:0,height:0,action:function(){AQUARIUM.main.changeScreen("fish")}},e={text:"Start two player game",x:0,y:0,width:0,height:0,action:function(){AQUARIUM.main.changeScreen("fish")}};return{init:a,update:b,render:c}}(),AQUARIUM.questionScreen=function(){function a(){h=AQUARIUM.fishScreen.getTotals(),j=e(),m.text=j.answer,m.visible=!1}function b(){AQUARIUM.input.setInputState(),AQUARIUM.input.justClicked()&&(AQUARIUM.input.isTextClicked(k),AQUARIUM.input.isTextClicked(l))}function c(){AQUARIUM.ctx.save(),AQUARIUM.ctx.fillStyle="#D71C40",AQUARIUM.ctx.fillRect(0,0,AQUARIUM.width,AQUARIUM.height),AQUARIUM.ctx.fillStyle="#FFFFFF",AQUARIUM.ctx.font="18pt sans-serif",AQUARIUM.ctx.textAlign="left",AQUARIUM.ctx.fillText(j.text,20,40),m.visible&&AQUARIUM.ctx.fillText(m.text,20,80),AQUARIUM.ctx.fillText(k.text,k.x,k.y),AQUARIUM.input.setTextDimensions(k,AQUARIUM.ctx),AQUARIUM.ctx.fillText(l.text,l.x,l.y),AQUARIUM.input.setTextDimensions(l,AQUARIUM.ctx),AQUARIUM.ctx.restore()}function d(a){var b;return b=a instanceof Array?h[a[0]][a[1]]:"object"==typeof h[a]?h[a].total:h[a]}function e(){for(var a,b,c,e,f={text:"",answer:0},g=[],h=[],j=Math.floor(4*Math.random());i===j;)j=Math.floor(4*Math.random());switch(i=j,j){case 0:f.text="How many fish were there?",f.answer=d("fish");break;case 1:g=["green","red","gold","small","medium","large"],a=AQUARIUM.utils.randomIndex(g),c=g[a],f.answer=d(c),f.text="How many "+c+" fish were there?";break;case 2:g=["green","red","gold","small","medium","large"],a=AQUARIUM.utils.randomIndex(g),c=g[a],h=g.slice(0),h.splice(a,1),b=AQUARIUM.utils.randomIndex(h),e=h[b],f.answer=d(c)>d(e)?"Yes":"No",f.text="Were there more "+c+" fish than "+e+" fish?";break;case 3:g=["small","medium","large"],a=AQUARIUM.utils.randomIndex(g),c=g[a],h=["green","red","gold"],b=AQUARIUM.utils.randomIndex(h),e=h[b],f.answer=d([c,e]),f.text="How many "+c+" "+e+" fish were there?"}return f}function f(){console.log("playAgainAction()"),AQUARIUM.main.changeScreen("fish")}function g(){console.log("seeAnswerAction()"),m.visible=!0}var h,i,j={text:"",answer:0},k={text:"See answer",x:20,y:340,width:0,height:0,action:g},l={text:"Play again",x:20,y:390,width:0,height:0,action:f},m={text:"",visible:!1};return{init:a,render:c,update:b}}(),AQUARIUM.resultScreen=function(){return{}}();